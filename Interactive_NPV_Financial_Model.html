<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPV Financial Model (Spread Logic)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .formula-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.75;
            overflow-x: auto;
        }
        .output-card {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
        }
        .output-card-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 0.25rem;
        }
        .output-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }
        .final-npv {
            background-color: #f0fdf4;
            border: 2px solid #4ade80;
        }
        .final-npv .output-card-value {
            color: #166534;
            font-size: 2rem;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 p-4 sm:p-6 md:p-8">

    <div class="w-full max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-slate-900 mb-2">NPV Financial Model (Spread Logic)</h1>
        <p class="text-slate-600 mb-8">An interactive model to forecast project cash flows using a real-world spread-based cost structure.</p>

        <!-- Formulas Section -->
        <div class="mb-8 space-y-4">
            <h2 class="text-xl font-semibold text-slate-900">Key Formulas</h2>
            <div class="formula-box">
                <p><span class="font-bold text-indigo-600">Marginal Cost</span> = (Avg. Tx Size * Net Spread %) + Gas Fee</p>
                <p><span class="font-bold text-indigo-600">Total Revenue</span> = Transactional Revenue + AUM Revenue</p>
                <p><span class="font-bold text-emerald-600">Project NPV</span> = PV(Cash Flows) + PV(Exit Value) - Initial Investment</p>
            </div>
        </div>

        <!-- Inputs Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 border-b border-slate-200 pb-8">
            <!-- Transactional Model Inputs -->
            <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                <h3 class="font-semibold text-slate-700">Transactional Model</h3>
                <div>
                    <label for="partnerVolume" class="block text-sm font-medium text-slate-700">Partner Monthly Volume (Txns)</label>
                    <input type="number" id="partnerVolume" value="100000" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                 <div>
                    <label for="penetrationRate" class="block text-sm font-medium text-slate-700">Market Penetration (at M36, %)</label>
                    <input type="number" id="penetrationRate" value="10" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="revenueShare" class="block text-sm font-medium text-slate-700">Our Revenue Share (%)</label>
                    <input type="number" id="revenueShare" value="50" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                 <div>
                    <label for="avgTxSize" class="block text-sm font-medium text-slate-700">Avg. Transaction Size ($)</label>
                    <input type="number" id="avgTxSize" value="300" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
            </div>
            
            <!-- AUM Model Inputs -->
            <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                <h3 class="font-semibold text-slate-700">AUM Model</h3>
                <div>
                    <label for="aumCaptureRate" class="block text-sm font-medium text-slate-700">AUM Capture Rate (%)</label>
                    <input type="number" id="aumCaptureRate" value="5" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="aumFee" class="block text-sm font-medium text-slate-700">Annual AUM Mgt. Fee (%)</label>
                    <input type="number" id="aumFee" value="1.5" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
            </div>

            <!-- Cost Inputs -->
            <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                <h3 class="font-semibold text-slate-700">Cost & Spread Model</h3>
                <div>
                    <label for="traditionalCost" class="block text-sm font-medium text-slate-700">Traditional Unit Cost ($)</label>
                    <input type="number" id="traditionalCost" value="11.00" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="gasFee" class="block text-sm font-medium text-slate-700">Gas Fee ($)</label>
                    <input type="number" id="gasFee" value="1.50" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="fixedCosts" class="block text-sm font-medium text-slate-700">Monthly Fixed Costs ($)</label>
                    <input type="number" id="fixedCosts" value="50000" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                 <!-- Spread Inputs -->
                <div>
                    <label for="cadUsdRate" class="block text-sm font-medium text-slate-700">Market CAD/USD</label>
                    <input type="number" id="cadUsdRate" value="1.33" step="0.001" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="cadUsdtRate" class="block text-sm font-medium text-slate-700">On-Ramp CAD/USDT</label>
                    <input type="number" id="cadUsdtRate" value="1.34" step="0.001" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="phpUsdRate" class="block text-sm font-medium text-slate-700">Market PHP/USD</label>
                    <input type="number" id="phpUsdRate" value="58.50" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                 <div>
                    <label for="phpUsdtRate" class="block text-sm font-medium text-slate-700">Off-Ramp PHP/USDT</label>
                    <input type="number" id="phpUsdtRate" value="58.80" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
            </div>

            <!-- Valuation Inputs -->
            <div class="space-y-4 p-4 bg-slate-50 rounded-lg">
                <h3 class="font-semibold text-slate-700">Valuation</h3>
                <div>
                    <label for="initialInvestment" class="block text-sm font-medium text-slate-700">Initial Investment ($)</label>
                    <input type="number" id="initialInvestment" value="1000000" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="discountRate" class="block text-sm font-medium text-slate-700">Annual Discount Rate (%)</label>
                    <input type="number" id="discountRate" value="25" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="exitMultiple" class="block text-sm font-medium text-slate-700">Exit Multiple (x Annual Revenue)</label>
                    <input type="number" id="exitMultiple" value="5" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                </div>
            </div>
        </div>

        <!-- Outputs -->
        <div>
            <h2 class="text-xl font-semibold text-slate-900 mb-4 text-center">Valuation Results</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="output-card">
                    <p class="output-card-title">Exit Value</p>
                    <p id="exitValueOutput" class="output-card-value">$0M</p>
                </div>
                <div class="output-card">
                    <p class="output-card-title">PV of Cash Flows</p>
                    <p id="pvCashFlowsOutput" class="output-card-value">$0M</p>
                </div>
                <div class="output-card">
                    <p class="output-card-title">PV of Exit Value</p>
                    <p id="pvExitValueOutput" class="output-card-value">$0M</p>
                </div>
                <div class="output-card final-npv col-span-2 md:col-span-4">
                    <p class="output-card-title">PROJECT NET PRESENT VALUE (NPV)</p>
                    <p id="npvOutput" class="output-card-value">$0M</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function formatMillions(num) {
            if (Math.abs(num) < 1000) return `$${num.toFixed(0)}`;
            if (Math.abs(num) < 1000000) return `$${(num / 1000).toFixed(1)}K`;
            return `$${(num / 1000000).toFixed(2)}M`;
        }

        function calculateNPV() {
            const inputs = {};
            const inputIds = [
                'partnerVolume', 'penetrationRate', 'revenueShare', 'avgTxSize',
                'aumCaptureRate', 'aumFee', 'fixedCosts', 'initialInvestment',
                'discountRate', 'exitMultiple', 'traditionalCost', 'gasFee',
                'cadUsdRate', 'cadUsdtRate', 'phpUsdRate', 'phpUsdtRate'
            ];
            inputIds.forEach(id => {
                inputs[id] = parseFloat(document.getElementById(id).value) || 0;
            });

            // --- Pre-calculation for Value Creation using Spread Model ---
            let onRampCostPercent = 0;
            if (inputs.cadUsdtRate > 0) {
                onRampCostPercent = (1 - (inputs.cadUsdRate / inputs.cadUsdtRate));
            }
            let offRampGainPercent = 0;
            if (inputs.phpUsdRate > 0) {
                offRampGainPercent = ((inputs.phpUsdtRate / inputs.phpUsdRate) - 1);
            }
            const netSpreadPercent = onRampCostPercent - offRampGainPercent;
            const rampCostValue = inputs.avgTxSize * netSpreadPercent;
            const marginalCost = rampCostValue + inputs.gasFee;
            const valueCreated = inputs.traditionalCost - marginalCost;

            // --- 36-Month Forecast Loop ---
            let monthlyCashFlows = [];
            let currentAUM = 0;
            let finalMonthRevenue = 0;
            const totalMonths = 36;

            for (let month = 1; month <= totalMonths; month++) {
                const currentPenetration = (inputs.penetrationRate / 100) * (month / totalMonths);
                const txnsProcessed = inputs.partnerVolume * currentPenetration;
                const tpv = txnsProcessed * inputs.avgTxSize;
                
                const txRevenue = txnsProcessed * valueCreated * (inputs.revenueShare / 100);
                const aumRevenue = currentAUM * (inputs.aumFee / 100 / 12);
                const totalRevenue = txRevenue + aumRevenue;
                
                const totalCOGS = txnsProcessed * marginalCost;
                const grossProfit = totalRevenue - totalCOGS;
                const pcfc = grossProfit - inputs.fixedCosts;
                monthlyCashFlows.push(pcfc);
                
                currentAUM += tpv * (inputs.aumCaptureRate / 100);

                if (month === totalMonths) {
                    finalMonthRevenue = totalRevenue;
                }
            }

            // --- Valuation Calculation ---
            const pvCashFlows = monthlyCashFlows.reduce((sum, cf, index) => {
                const month = index + 1;
                return sum + (cf / Math.pow(1 + (inputs.discountRate/100), month / 12));
            }, 0);

            const annualizedRevenue = finalMonthRevenue * 12;
            const exitValue = annualizedRevenue * inputs.exitMultiple;
            const pvExitValue = exitValue / Math.pow(1 + (inputs.discountRate / 100), totalMonths / 12);
            const projectValue = pvCashFlows + pvExitValue;
            const npv = projectValue - inputs.initialInvestment;

            // --- Update UI ---
            document.getElementById('exitValueOutput').textContent = formatMillions(exitValue);
            document.getElementById('pvCashFlowsOutput').textContent = formatMillions(pvCashFlows);
            document.getElementById('pvExitValueOutput').textContent = formatMillions(pvExitValue);
            document.getElementById('npvOutput').textContent = formatMillions(npv);
        }

        const allInputs = document.querySelectorAll('input');
        allInputs.forEach(input => {
            input.addEventListener('input', calculateNPV);
        });

        window.onload = calculateNPV;
    </script>
</body>
</html>
