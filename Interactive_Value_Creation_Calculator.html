<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per-Transaction Value Creation Calculator (Live Simulation)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .formula-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.75;
            overflow-x: auto;
        }
        .output-box {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        .output-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: #166534;
        }
        .input-group {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .live-rates-window {
            background-color: #1e293b; /* slate-800 */
            color: #f8fafc; /* slate-50 */
            border-radius: 0.5rem;
            padding: 1rem;
            border: 1px solid #334155; /* slate-700 */
        }
        .rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #334155;
        }
        .rate-item:last-child {
            border-bottom: none;
        }
        .rate-value {
            font-weight: 600;
            color: #94a3b8; /* slate-400 */
        }
        .rate-value.up { color: #4ade80; /* green-400 */ }
        .rate-value.down { color: #f87171; /* red-400 */ }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl bg-white rounded-xl shadow-lg p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-slate-900 mb-2">Value Creation Calculator (Live Simulation)</h1>
        <p class="text-slate-600 mb-6">This model simulates live API calls to calculate cost savings from real-time exchange rate spreads.</p>
        
        <div class="grid md:grid-cols-3 gap-8">
            
            <!-- Live Rates Simulation -->
            <div class="md:col-span-1">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">Live Market Rates</h2>
                <div class="live-rates-window">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold">Data Feed (Simulated)</h3>
                        <button id="refreshButton" class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-1 px-3 rounded-md transition-colors">
                            Refresh
                        </button>
                    </div>
                    <p id="timestamp" class="text-xs text-slate-500 mb-4">Last updated: --</p>
                    <div id="ratesContainer" class="space-y-2">
                        <!-- Rates will be injected here by JS -->
                    </div>
                </div>
            </div>

            <!-- Main Calculator -->
            <div class="md:col-span-2">
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Inputs Section -->
                    <div class="space-y-6">
                        <h2 class="text-xl font-semibold text-slate-900">Input Assumptions</h2>
                        
                        <!-- On-Ramp Inputs -->
                        <div class="input-group space-y-4">
                            <h3 class="font-medium text-slate-800">On-Ramp (CAD to USDT)</h3>
                            <div>
                                <label for="cadUsdRate" class="block text-sm font-medium text-slate-700">Market Rate (CAD per USD)</label>
                                <input type="number" id="cadUsdRate" value="1.33" step="0.0001" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                            <div>
                                <label for="cadUsdtRate" class="block text-sm font-medium text-slate-700">On-Ramp Rate (CAD per USDT)</label>
                                <input type="number" id="cadUsdtRate" value="1.34" step="0.0001" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                        </div>

                        <!-- Off-Ramp Inputs -->
                        <div class="input-group space-y-4">
                            <h3 class="font-medium text-slate-800">Off-Ramp (USDT to PHP)</h3>
                            <div>
                                <label for="phpUsdRate" class="block text-sm font-medium text-slate-700">Market Rate (PHP per USD)</label>
                                <input type="number" id="phpUsdRate" value="58.50" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                            <div>
                                <label for="phpUsdtRate" class="block text-sm font-medium text-slate-700">Off-Ramp Rate (PHP per USDT)</label>
                                <input type="number" id="phpUsdtRate" value="58.80" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                        </div>

                        <!-- General Inputs -->
                        <div class="space-y-4 pt-4">
                            <div>
                                <label for="traditionalCost" class="block text-sm font-medium text-slate-700">Traditional Unit Cost ($)</label>
                                <input type="number" id="traditionalCost" value="11.00" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                            <div>
                                <label for="avgTxSize" class="block text-sm font-medium text-slate-700">Avg. Transaction Size ($)</label>
                                <input type="number" id="avgTxSize" value="300" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                            <div>
                                <label for="gasFee" class="block text-sm font-medium text-slate-700">Gas Fee ($)</label>
                                <input type="number" id="gasFee" value="1.50" step="0.01" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm p-2">
                            </div>
                        </div>
                    </div>

                    <!-- Outputs Section -->
                    <div class="space-y-4 flex flex-col justify-center">
                         <h2 class="text-xl font-semibold text-slate-900 text-center">Calculated Results</h2>
                         <div class="grid grid-cols-2 gap-4">
                            <div class="output-box bg-red-50 border-red-200">
                                <p class="text-sm font-medium text-slate-700">On-Ramp Cost</p>
                                <p id="onRampOutput" class="output-value text-red-800">0.00%</p>
                            </div>
                             <div class="output-box">
                                <p class="text-sm font-medium text-slate-700">Off-Ramp Gain</p>
                                <p id="offRampOutput" class="output-value">0.00%</p>
                            </div>
                         </div>
                        <div class="output-box bg-slate-50 border-slate-200">
                            <p class="text-sm font-medium text-slate-700">Our Marginal Cost</p>
                            <p id="marginalCostOutput" class="output-value text-slate-800">$0.00</p>
                        </div>
                        <div class="output-box bg-emerald-50 border-emerald-200">
                            <p class="text-sm font-medium text-slate-700">Total Value Created Per Transaction</p>
                            <p id="valueCreatedOutput" class="output-value text-emerald-800">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const inputElements = {};
        const inputIds = [
            'cadUsdRate', 'cadUsdtRate', 'phpUsdRate', 'phpUsdtRate',
            'traditionalCost', 'avgTxSize', 'gasFee'
        ];
        inputIds.forEach(id => inputElements[id] = document.getElementById(id));

        const onRampOutput = document.getElementById('onRampOutput');
        const offRampOutput = document.getElementById('offRampOutput');
        const marginalCostOutput = document.getElementById('marginalCostOutput');
        const valueCreatedOutput = document.getElementById('valueCreatedOutput');
        const refreshButton = document.getElementById('refreshButton');
        const timestampEl = document.getElementById('timestamp');
        const ratesContainer = document.getElementById('ratesContainer');

        // Store previous values for color coding
        let previousRates = {};

        // --- Live Simulation Function ---
        function simulateApiCall() {
            // 1. Simulate Fiat Market Rates (like from Google Finance)
            const baseCadUsd = 1.33;
            const newCadUsd = baseCadUsd + (Math.random() - 0.5) * 0.02; // Fluctuate by +/- 0.01

            const basePhpUsd = 58.50;
            const newPhpUsd = basePhpUsd + (Math.random() - 0.5) * 0.2; // Fluctuate by +/- 0.1

            // 2. Simulate On-Ramp Spread (like from Coinbase)
            // Spread usually widens or shrinks slightly
            const onRampSpread = 0.005 + (Math.random() * 0.01); // 0.5% to 1.5% cost
            const newCadUsdt = newCadUsd / (1 - onRampSpread);

            // 3. Simulate Off-Ramp Premium
            const offRampPremium = 0.004 + (Math.random() * 0.005); // 0.4% to 0.9% gain
            const newPhpUsdt = newPhpUsd * (1 + offRampPremium);

            // 4. Update Input Fields
            inputElements.cadUsdRate.value = newCadUsd.toFixed(4);
            inputElements.cadUsdtRate.value = newCadUsdt.toFixed(4);
            inputElements.phpUsdRate.value = newPhpUsd.toFixed(2);
            inputElements.phpUsdtRate.value = newPhpUsdt.toFixed(2);
            
            // 5. Update Live Rates Window
            updateLiveRatesUI({ newCadUsd, newCadUsdt, newPhpUsd, newPhpUsdt });

            // 6. Trigger main calculation
            calculate();
        }
        
        // --- UI Update for Live Rates ---
        function updateLiveRatesUI(rates) {
            const now = new Date();
            timestampEl.textContent = `Last updated: ${now.toLocaleTimeString()}`;
            
            const rateData = [
                { label: 'Market CAD/USD', value: rates.newCadUsd, prev: previousRates.newCadUsd, fixed: 4 },
                { label: 'On-Ramp CAD/USDT', value: rates.newCadUsdt, prev: previousRates.newCadUsdt, fixed: 4 },
                { label: 'Market PHP/USD', value: rates.newPhpUsd, prev: previousRates.newPhpUsd, fixed: 2 },
                { label: 'Off-Ramp PHP/USDT', value: rates.newPhpUsdt, prev: previousRates.newPhpUsdt, fixed: 2 }
            ];
            
            ratesContainer.innerHTML = rateData.map(item => {
                let colorClass = '';
                if (item.prev) {
                    if (item.value > item.prev) colorClass = 'up';
                    if (item.value < item.prev) colorClass = 'down';
                }
                return `
                    <div class="rate-item">
                        <span class="text-sm">${item.label}</span>
                        <span class="rate-value ${colorClass}">${item.value.toFixed(item.fixed)}</span>
                    </div>
                `;
            }).join('');
            
            previousRates = rates;
        }


        // --- Main Calculation Function ---
        function calculate() {
            const values = {};
            inputIds.forEach(id => {
                values[id] = parseFloat(inputElements[id].value) || 0;
            });

            let onRampCostPercent = 0;
            if (values.cadUsdtRate > 0) {
                onRampCostPercent = (1 - (values.cadUsdRate / values.cadUsdtRate));
            }

            let offRampGainPercent = 0;
            if (values.phpUsdRate > 0) {
                offRampGainPercent = ((values.phpUsdtRate / values.phpUsdRate) - 1);
            }

            const netSpreadPercent = onRampCostPercent - offRampGainPercent;
            const rampCostValue = values.avgTxSize * netSpreadPercent;
            const marginalCost = rampCostValue + values.gasFee;
            const valueCreated = values.traditionalCost - marginalCost;

            onRampOutput.textContent = `${(onRampCostPercent * 100).toFixed(2)}%`;
            offRampOutput.textContent = `${(offRampGainPercent * 100).toFixed(2)}%`;
            marginalCostOutput.textContent = `$${marginalCost.toFixed(2)}`;
            valueCreatedOutput.textContent = `$${valueCreated.toFixed(2)}`;
        }

        // --- Event Listeners ---
        Object.values(inputElements).forEach(input => {
            input.addEventListener('input', calculate);
        });
        refreshButton.addEventListener('click', simulateApiCall);

        // --- Initial Load ---
        window.onload = () => {
             simulateApiCall(); // Load with initial "live" data
        };
    </script>

</body>
</html>
